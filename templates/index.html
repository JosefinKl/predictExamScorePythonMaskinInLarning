<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Exam Score Predictor</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background-color: #64958f; }
        h1 { color: #070e10; }
        .container { max-width: 500px; margin: auto; background: #b2c4c8; padding: 17px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
        label { display: block; margin-top: 10px; }
        input { width: 90%; padding: 8px; margin-top: 5px; }
        button { margin-top: 15px; padding: 10px 15px; background: #0e8095; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #5ea3c5; }
        .result { margin-top: 15px; padding: 10px; background: #e2e2e2; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Exam Score Predictor</h1>

        <label id="usernameLabel">Username</label>
        <input type="text" id="username" placeholder="Username">

        <label id="passwordLabel">Password</label>
        <input type="password" id="password" placeholder="Password">

        <button id="loginButton" onclick="login()">Login</button>

        <hr>

        <label>Hours Studied</label>
        <input type="number" id="hours_studied" placeholder="Hours studied">

        <label>Attendance</label>
        <input type="number" id="attendance" placeholder="Attendance %">

        <button onclick="predict()">Predict Exam Score</button>

        <div class="result" id="result"></div>
    </div>

    <script>
        let token = "";

        async function login() {

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            const response = await fetch("/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password })
            });

            const data = await response.json();
            //Alert box to tell user if log in successful or failed
            if (response.ok) {
                token = data.access_token;
                
                document.getElementById("usernameLabel").style.display = "none";
                document.getElementById("passwordLabel").style.display = "none";
                document.getElementById("username").style.display = "none";
                document.getElementById("password").style.display = "none";
                document.getElementById("loginButton").style.display = "none";
                alert("Login successful!");
            } else {
                alert(data.msg || "Login failed");
            }
        }

        async function predict() {
            const hours = parseFloat(document.getElementById("hours_studied").value);
            const attendance = parseFloat(document.getElementById("attendance").value);
            
            if (!token) { alert("You need to log in to access"); return; }

            let response;
            

            if (hours && !attendance){
                response = await fetch("/examScoreHoursStudied", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({ hours_studied: hours})
            });
            }else if(hours && attendance){
                response = await fetch("/examScoreHoursStudiedAndAttendance", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({ hours_studied: hours, attendance: attendance })
            });
            }else if(!hours && attendance){
                response = await fetch("/examScoreAttendance", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({attendance: attendance })
            });
            }else {
                alert("Please enter at least hours studied or attendance!");
                return;  
            }


            const data = await response.json();

            if (data.predicted_exam_score > 60) {
                document.getElementById("result").style.backgroundColor = "lightgreen";
            } 
            else{document.getElementById("result").style.backgroundColor = "red";}

            if (response.ok) {
                document.getElementById("result").innerHTML = `
                    <strong>Predicted Exam Score:</strong> ${data.predicted_exam_score} <br>
                    
                `;
            } else {
                document.getElementById("result").innerHTML = `<strong>Error:</strong> ${data.error}`;
            }
        }
    </script>
</body>
</html>
